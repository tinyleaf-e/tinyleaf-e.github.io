(function(){"use strict";var e={9959:function(e,t,a){var r=a(7332),s=a.n(r),o=a(1722),n=a.n(o),i=a(9087),c=a.n(i),l=a(1017),d=a.n(l),u=a(9983),f=a.n(u),p=a(7393),v=a.n(p),h=a(4837),m=a.n(h),g=a(1987),_=a.n(g),y=a(4247),S=a.n(y),C=a(7579),D=a.n(C),b=a(2856),x=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("div",{staticClass:"body"},["today"===e.activeItem?t("CurrentDay"):e._e(),"history"===e.activeItem?t("HistoryRecord"):e._e(),"profile"===e.activeItem?t("UserProfile"):e._e()],1),t("div",{staticClass:"footer",on:{click:e.triggerHiddenMenu}},[t("div",{staticClass:"item",attrs:{active:"today"===e.activeItem},on:{click:function(t){e.activeItem="today"}}},[e._m(0),e._v("今天")]),t("div",{staticClass:"item",attrs:{active:"history"===e.activeItem},on:{click:function(t){e.activeItem="history"}}},[e._m(1),e._v("回顾")]),e.showHiddenMenu?t("div",{staticClass:"item",attrs:{active:"profile"===e.activeItem},on:{click:function(t){e.activeItem="profile"}}},[e._m(2),e._v("我")]):e._e()])])},w=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon"},[t("i",{staticClass:"el-icon-medal"})])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon"},[t("i",{staticClass:"el-icon-s-order"})])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon"},[t("i",{staticClass:"el-icon-user"})])}],M=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{height:"100%",overflow:"hidden"}},[t("div",{staticClass:"title fixed"},[e._v("今日计分")]),t("div",{staticClass:"score-operation-box fixed"},[t("el-carousel",{attrs:{type:"card",height:"200px",arrow:"never",autoplay:!1},on:{change:e.handleCarouselChange}},[t("el-carousel-item",[t("div",{staticClass:"score-btn plus",attrs:{scale:0!==e.currentCarouselIdx},on:{click:function(t){return e.showScoreDialog("plus")}}},[t("div",{staticClass:"backcolor wave plus"}),t("div",{staticClass:"text-info"},[t("div",{staticClass:"score-count"},[t("span",{staticClass:"desc"},[e._v("今日总计")]),t("span",{staticClass:"score plus"},[e._v(e._s(`+${e.positiveScoreSum}`))]),t("span",{staticClass:"unit"},[e._v("分")])]),t("div",{staticClass:"score plus"},[e._v("点击+1")])])])]),t("el-carousel-item",[t("div",{staticClass:"score-btn minus",attrs:{scale:1!==e.currentCarouselIdx},on:{click:function(t){return e.showScoreDialog("minus")}}},[t("div",{staticClass:"backcolor wave minus"}),t("div",{staticClass:"text-info"},[t("div",{staticClass:"score-count"},[t("span",{staticClass:"desc"},[e._v("今日总计")]),t("span",{staticClass:"score minus"},[e._v(e._s("-"+-e.negativeScoreSum))]),t("span",{staticClass:"unit"},[e._v("分")])]),t("div",{staticClass:"score minus"},[e._v("点击-1")])])])])],1)],1),t("div",{staticClass:"holder"}),t("div",{staticClass:"score-detail-box"},e._l(e.recordData,(function(a,r){return t("div",{key:r,staticClass:"score-item"},[t("div",{staticClass:"score",attrs:{type:a.score>0?"plus":"minus"}},[e._v(" "+e._s(`${a.score>0?"+":""}${a.score}`)+" ")]),t("div",{staticClass:"detail"},[t("div",[t("el-tag",{attrs:{size:"mini",type:a.score>0?"":"danger"}},[e._v(e._s(a.reason))])],1),t("div",{staticClass:"time"},[t("span",[e._v(e._s(e.formatDateTime(e.formatDateStrFromUTC(a.create_time))))]),t("span",{staticClass:"ago"},[e._v(e._s(e.timeAgo(e.formatDateStrFromUTC(a.create_time))))])])])])})),0),t("el-dialog",{attrs:{visible:e.dialogVisible,"show-close":!1,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.dialogVisible?t("AddScoreRecord",{staticStyle:{"margin-top":"-25px"},attrs:{"score-type":e.currentScoreType},on:{added:e.handleScoreAdded}}):e._e()],1)],1)},$=[],O=a(1232),T=a.n(O),k=a(417);function A(){return localStorage.id}function R(e,t=!0){const a=k.A.create({baseURL:{NODE_ENV:"production",BASE_URL:""}.VUE_APP_BASE_API,timeout:5e5,withCredentials:!0});return a.interceptors.request.use((e=>(e.headers["userid"]=A(),e)),(e=>(console.log(e),Promise.reject(e)))),a.interceptors.response.use((e=>{const a=e.data;try{a.data&&void 0!==a.data.total&&void 0!==a.data.items&&("string"===typeof a.data.total&&/^[0-9]+$/.test(a.data.total)&&(a.data.total=parseInt(a.data.total,10)),0===a.data.total&&(a.data.items=[]))}catch(r){console.log("error when process response:",r)}return 0!==a.code&&0!==a.state.code&&t?(s()({message:a.state.msg||"Error",type:"error",duration:5e3}),50008!==a.state.code&&50012!==a.state.code&&50014!==a.state.code||T().confirm("You have been logged out, you can cancel to stay on this page, or log in again","Confirm logout",{confirmButtonText:"Re-Login",cancelButtonText:"Cancel",type:"warning"}).then((()=>{})),Promise.reject(new Error(a.state.msg||"Error"))):a}),(e=>(console.log(`err${e}`),s()({message:e.message,type:"error",duration:5e3}),Promise.reject({code:-1})))),a(e)}var I=R;let U="http://localhost:9000";function j(e){return I({baseURL:U,url:"/getScoreOfDay",method:"get",params:e})}function P(e){return I({baseURL:U,url:"/addScore",method:"post",data:e})}function E(e){return I({baseURL:U,url:"/getScoreSumOfCurrentMonth",method:"get",params:e})}function F(e){return I({baseURL:U,url:"/searchScoreReasonsByCount",method:"get",params:e})}U="https://1252077373-hz6o1j8fiy.ap-beijing.tencentscf.com";var H=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title"},[e._v(e._s(("plus"===e.scoreType?"+":"-")+"1分"))]),t("div",[t("el-select",{staticStyle:{width:"100%"},attrs:{id:"select-input",filterable:"","allow-create":"","default-first-option":"",placeholder:`选择或输入${"plus"===e.scoreType?"加":"减"}分事由`},on:{"visible-change":e.removeSelectReadyOnly,blur:e.removeSelectReadyOnly,focus:e.removeSelectReadyOnly},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}},e._l(e.reasonOptions,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.reason}},[t("div",{staticClass:"reason-option"},[t("div",[t("span",[e._v(e._s(a.reason))])]),t("div",{staticClass:"info"},[t("span",[e._v(e._s(`使用${a.count}次`))]),t("span",{staticStyle:{"margin-left":"6px"}},[e._v(e._s(`${e.timeAgo(e.formatDateStrFromUTC(a.latest_create_time))}使用`))])])])])})),1)],1),t("el-button",{staticClass:"btn",attrs:{type:"primary",plain:""},on:{click:e.addRecord}},[e._v("确认")])],1)},B=[];function V(e){e=new Date(e);const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");return`${t}-${a}-${r} ${s}:${o}:${n}`}function L(e){e=new Date(e);const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`}function z(e){e=new Date(e);const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${t}-${a}`}function Y(e){e=new Date(e);const t=new Date,a=Math.floor((t-e)/1e3);if(a<60)return`${a}秒前`;const r=Math.floor(a/60);if(r<60)return`${r}分钟前`;const s=Math.floor(r/60);if(s<24)return`${s}小时前`;const o=Math.floor(s/24);if(o<30)return`${o}天前`;const n=Math.floor(o/30);if(n<12)return`${n}个月前`;const i=Math.floor(n/12);return`${i}年前`}function N(e){const t=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/,a=e.match(t);if(a){const e=a[1],t=a[2],r=a[3],s=a[4],o=a[5],n=a[6];return`${e}-${t}-${r} ${s}:${o}:${n}`}return""}var q={name:"AddScoreRecord",props:{scoreType:{type:String}},data(){return{reason:"",reasonOptions:[]}},mounted(){this.removeSelectReadyOnly(),this.searchScoreReasonsByCount()},methods:{formatDateTime:V,timeAgo:Y,formatDateStrFromUTC:N,addRecord(){P({score:"plus"===this.scoreType?1:-1,reason:this.reason}).then((e=>{0===e.code?this.$message({message:"plus"===this.scoreType?"成功添加！每天都有新进步哦~":"添加记录，不要灰心呀~",type:"success"}):this.$message("error"),this.$emit("added")})).catch((e=>{console.log(e)}))},searchScoreReasonsByCount(){F({score_type:"plus"===this.scoreType?1:-1}).then((e=>{console.log(e),this.reasonOptions=e.data})).catch((e=>{console.log(e)}))},removeSelectReadyOnly(){document.getElementById("select-input").removeAttribute("readOnly")}}},G=q,J=a(1656),K=(0,J.A)(G,H,B,!1,null,"b05c0f84",null),Q=K.exports,W={name:"CurrentDay",components:{AddScoreRecord:Q},props:[{name:"fd"}],data(){return{recordData:[],dialogVisible:!1,currentScoreType:"plus",currentCarouselIdx:0}},computed:{positiveScoreSum(){return this.recordData.reduce(((e,t)=>e+(t.score>0?t.score:0)),0)},negativeScoreSum(){return this.recordData.reduce(((e,t)=>e+(t.score<0?t.score:0)),0)}},mounted(){this.getScoreOfDay()},methods:{formatDateTime:V,timeAgo:Y,formatDateStrFromUTC:N,getScoreOfDay(){j({date:L(new Date)}).then((e=>{console.log(e),this.recordData=e.data.reverse()})).catch((e=>{console.log(e)}))},showScoreDialog(e){e===this.currentScoreType&&(this.dialogVisible=!0),this.currentScoreType=e},handleCarouselChange(e){this.currentCarouselIdx=e},handleScoreAdded(){this.getScoreOfDay(),this.dialogVisible=!1}}},X=W,Z=(0,J.A)(X,M,$,!1,null,"20ab7962",null),ee=Z.exports,te=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title fixed"},[e._v("本月回顾")]),t("div",{staticClass:"holder"}),t("div",{staticClass:"context"},[t("el-calendar",{scopedSlots:e._u([{key:"dateCell",fn:function({date:a}){return[t("div",{staticClass:"score-cell"},[e.recordDataMap[e.formatDate(a)]?t("div",{staticClass:"background-indicator plus",style:{height:100*e.clamp(e.recordDataMap[e.formatDate(a)].positive_score/e.expectedScore,.01,1)+"%"}}):e._e(),e.recordDataMap[e.formatDate(a)]?t("div",{staticClass:"background-indicator minus",style:{height:100*e.clamp(-e.recordDataMap[e.formatDate(a)].negative_score/e.expectedScore,.01,1)+"%"}}):e._e(),t("div",{staticClass:"date"},[e._v(e._s(a.getDate()))]),e.recordDataMap[e.formatDate(a)]?t("div",[t("div",{staticClass:"detail plus"},[e._v("+"),t("span",[e._v(e._s(e.recordDataMap[e.formatDate(a)].positive_score))])]),t("div",{staticClass:"detail minus"},[e._v("- "),t("span",[e._v(e._s(-e.recordDataMap[e.formatDate(a)].negative_score))])])]):e._e()])]}}]),model:{value:e.calendarDate,callback:function(t){e.calendarDate=t},expression:"calendarDate"}})],1)])},ae=[],re={name:"HistoryRecord",data(){return{calendarDate:new Date,recordData:[],lastDate:"",expectedScore:15}},mounted(){this.getScoreSumOfCurrentMonth(L(new Date))},computed:{recordDataMap(){return this.recordData.reduce(((e,t)=>(e[L(t.date)]={positive_score:t.positive_score,negative_score:t.negative_score},e)),{})}},watch:{calendarDate(e){z(e)!==z(this.lastDate)&&this.getScoreSumOfCurrentMonth(L(e))}},methods:{formatDateTime:V,timeAgo:Y,formatDate:L,getScoreSumOfCurrentMonth(e){this.lastDate=e,E({date:e}).then((e=>{console.log(e),this.recordData=e.data})).catch((e=>{console.log(e)}))},clamp(e,t,a){return Math.min(Math.max(e,t),a)}}},se=re,oe=(0,J.A)(se,te,ae,!1,null,"6f41797e",null),ne=oe.exports;function ie(e){e=e||16;let t="abcdefhijkmnprstwxyz2345678",a=t.length,r="";for(let s=0;s<e;s++)r+=t.charAt(Math.floor(Math.random()*a));return r}function ce(e,t){e=Math.max(parseInt(e),0)||5,t=Math.max(parseInt(t),0)||5;let a=new Array(e).fill(new Date(0)),r=0;return{add(){a[r++%e]=new Date},ok(){return new Date-a[(r+1)%e]<1e3*t}}}var le=a(2882),de=a.n(le),ue=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{padding:"20px"}},[t("div",{staticStyle:{height:"60px","line-height":"60px","font-size":"26px","text-align":"center"}},[e._v("个人信息")]),t("div",[t("el-input",{staticStyle:{width:"100%"},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}})],1),t("div",[t("el-button",{staticStyle:{width:"100%","margin-top":"20px"},on:{click:e.editUser}},[e._v("修改")])],1),t("div",{staticStyle:{"margin-top":"20px",color:"red"}},[e._v("用于不同浏览器间的数据迁移，修改完成后刷新页面即可，谨慎操作")])])},fe=[],pe={name:"UserProfile",data(){return{user:""}},created(){this.user=localStorage.id},methods:{editUser(){localStorage.id=this.user,de().set("score_record_user",this.user),this.$message({message:"修改成功，请刷新页面",type:"success"})}}},ve=pe,he=(0,J.A)(ve,ue,fe,!1,null,"5d4532dd",null),me=he.exports,ge={name:"App",components:{UserProfile:me,HistoryRecord:ne,CurrentDay:ee},data(){return{activeItem:"today",hiddenMenuCounter:{},showHiddenMenu:!1}},created(){de().set("score_record_user",this.getID()),this.hiddenMenuCounter=ce(5,2)},methods:{getID(){if(localStorage.id)return localStorage.id;{let e=ie();return localStorage.id=e,e}},triggerHiddenMenu(){this.hiddenMenuCounter.ok()?this.showHiddenMenu=!0:this.hiddenMenuCounter.add()}}},_e=ge,ye=(0,J.A)(_e,x,w,!1,null,"00f92287",null),Se=ye.exports;b["default"].config.productionTip=!1,b["default"].use(D()),b["default"].use(S()),b["default"].use(_()),b["default"].use(m()),b["default"].use(v()),b["default"].use(f()),b["default"].use(d()),b["default"].use(c()),b["default"].use(n()),b["default"].prototype.$message=s(),new b["default"]({render:e=>e(Se)}).$mount("#app")}},t={};function a(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,r,s,o){if(!r){var n=1/0;for(d=0;d<e.length;d++){r=e[d][0],s=e[d][1],o=e[d][2];for(var i=!0,c=0;c<r.length;c++)(!1&o||n>=o)&&Object.keys(a.O).every((function(e){return a.O[e](r[c])}))?r.splice(c--,1):(i=!1,o<n&&(n=o));if(i){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,s,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,r){var s,o,n=r[0],i=r[1],c=r[2],l=0;if(n.some((function(t){return 0!==e[t]}))){for(s in i)a.o(i,s)&&(a.m[s]=i[s]);if(c)var d=c(a)}for(t&&t(r);l<n.length;l++)o=n[l],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},r=self["webpackChunkscore_record_frontend"]=self["webpackChunkscore_record_frontend"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=a.O(void 0,[504],(function(){return a(9959)}));r=a.O(r)})();
//# sourceMappingURL=app.b4916bb7.js.map